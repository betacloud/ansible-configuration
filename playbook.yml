# This file is subject to the terms and conditions defined in file 'LICENSE',
# which is part of this repository.
---
- name: Install python version 2 on ubuntu
  hosts: ubuntu
  gather_facts: no
  tasks:
  - name: Install python version 2 on ubuntu
    raw: test -e /usr/bin/python || (test -e /usr/bin/apt && (apt -y update && apt install -y python-minimal))
    register: result
    changed_when: result.rc != 0
    become: true

- name: Playbook for role testing
  hosts: all

  vars:
    configuration_type: tarball
    configuration_tarball_name: kolla
    configuration_tarball_path: kolla
    configuration_tarball_protocol: http
    configuration_tarball_server: tarballs.openstack.org
    configuration_tarball_version: 4.0.0

  roles:
    - role: ansible-configuration

- name: Playbook for role testing
  hosts: all

  vars:
    configuration_type: git

  pre_tasks:
  - name: Remove existing configuration directory
    file:
      path: "{{ configuration_directory }}"
      state: absent
    become: true

  - name: Include molecule variables
    include_vars: vars/molecule.yml

  roles:
  - role: ansible-configuration
